<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Jinja Template</title>
    <script src="{{ url_for('static', filename='js/scripts.js') }}" defer></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header>
        <h1>Header</h1>
    </header>
    <div class="sidebar-left">
        {% block sidebar_left %}
        <h2>Play Records</h2>

<!-- Recent Events Section -->
<div>
    <h3>Recent Events</h3>
    <div class="slider" id="recent-events">
        <button class="slider-btn" onclick="moveSlide('recent-events', -1)">&lt;</button>
        <ul class="slider-content"></ul>
        <button class="slider-btn" onclick="moveSlide('recent-events', 1)">&gt;</button>
    </div>
</div>

<!-- Completed Quests Section -->
<div>
    <h3>Completed Quests</h3>
    <div class="slider" id="completed-quests">
        <button class="slider-btn" onclick="moveSlide('completed-quests', -1)">&lt;</button>
        <ul class="slider-content"></ul>
        <button class="slider-btn" onclick="moveSlide('completed-quests', 1)">&gt;</button>
    </div>
</div>

<!-- Current Quest Section -->
<div>
    <h3>Current Quest</h3>
    <div id="current-quest"></div>
</div>
        {% endblock %}
    </div>
    <main>
        {% block main %}
        <h1>Script Lines</h1>
    <div>
        {% for line in scripts.script %}
            <div class="script-line">{{ line }}</div>
        {% endfor %}
    </div>

    <!-- 선택지 버튼 추가 -->
    <div class="choices" style="margin-top: 20px;">
        <button style="padding: 10px 20px; margin-right: 10px;">선택지1</button>
        <button style="padding: 10px 20px; margin-right: 10px;">선택지2</button>
        <button style="padding: 10px 20px;">주사위사용</button>
    </div>

    <!-- 채팅창 추가 -->
    <div class="chatbox" style="margin-top: 20px;">
        <form action="#" method="post" style="display: flex; align-items: center;">
            <input 
                type="text" 
                name="user_input" 
                placeholder="직접 입력하기" 
                style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-right: 10px;">
            <button type="submit" style="padding: 10px 20px;">전송</button>
        </form>
    </div>
        {% endblock %}
    </main>
    <div class="sidebar-right">
        {% block sidebar_right %}
        <h2>{{ character.name }}</h2>
        <p>Job: {{ character.job }}</p>
        <p>Strength: {{ character.stats.Strength }}</p>
        <p>Dexterity: {{ character.stats.Dexterity }}</p>
        <p>Defense: {{ character.stats.Defense }}</p>
        <h2>Character Configuration</h2>

    <!-- 플레이어 이름과 직업 입력 -->
    <div>
        <label for="name">Name:</label>
        <input type="text" id="name" value="{{ character.name }}">
    </div>
    <div>
        <label for="job">Job:</label>
        <input type="text" id="job" value="{{ character.job }}">
    </div>

    <!-- 남은 포인트 표시 -->
    <h3>Allocate Your Stats</h3>
    <p>Remaining Points: <span id="points">{{ character.points }}</span></p>

    <div>
        <p>Strength: <span id="strength">{{ character.stats.Strength }}</span></p>
        <button onclick="updateStat('Strength', 1)">+1</button>
        <button onclick="updateStat('Strength', -1)">-1</button>
    </div>
    <div>
        <p>Dexterity: <span id="dexterity">{{ character.stats.Dexterity }}</span></p>
        <button onclick="updateStat('Dexterity', 1)">+1</button>
        <button onclick="updateStat('Dexterity', -1)">-1</button>
    </div>
    <div>
        <p>Defense: <span id="defense">{{ character.stats.Defense }}</span></p>
        <button onclick="updateStat('Defense', 1)">+1</button>
        <button onclick="updateStat('Defense', -1)">-1</button>
    </div>
    
    
    <!-- 아이템 정보 표시 -->
    <h3>Items</h3>
    <p>{{ character.items_name }} - Quantity: {{ character.items_quantity }}</p>

    <!-- 초기화 및 확정 버튼 -->
    <button onclick="resetStats()">Reset</button>
    <button onclick="confirmCharacter()">Confirm</button>

    <script>
        // 스탯 업데이트 함수
        function updateStat(stat, amount) {
            fetch('/update_stats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ stat: stat, amount: amount }),
            })
            .then(response => response.json())
            .then(data => {
                // UI 업데이트
                document.getElementById('strength').textContent = data.stats.Strength;
                document.getElementById('dexterity').textContent = data.stats.Dexterity;
                document.getElementById('defense').textContent = data.stats.Defense;
                document.getElementById('points').textContent = data.points;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }


        // 스탯 초기화 함수
        function resetStats() {
            fetch('/reset_stats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                // UI 초기화
                document.getElementById('strength').textContent = data.stats.Strength;
                document.getElementById('dexterity').textContent = data.stats.Dexterity;
                document.getElementById('defense').textContent = data.stats.Defense;
                document.getElementById('points').textContent = data.points;

                // 이름과 직업 초기화
                document.getElementById('name').value = data.name;
                document.getElementById('job').value = data.job;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // 캐릭터 확정 함수
        function confirmCharacter() {
            const name = document.getElementById('name').value;
            const job = document.getElementById('job').value;
            const points = parseInt(document.getElementById('points').textContent, 10);

            if (!name) {
                alert('Please enter a name for your character.');
                return;
            }

            if (!job) {
                alert('Please choose a job for your character.');
                return;
            }

            if (points > 0) {
                alert('You must allocate all points before proceeding.');
                return;
            }

            fetch('/confirm_character', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name: name, job: job }),
            })
            .catch(error => {
                console.error('Error:', error);
            });

        }
    </script>
        {% endblock %}
    </div>
    <footer>
        <p>Footer content here.</p>
    </footer>
</body>
</html>
